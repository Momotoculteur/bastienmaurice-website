# Analyse de vuln√©rabilit√©s dans les images Docker avec Trivy

Bastien MAURICE
<!-- .slide: data-background="#009485" -->
<!-- .slide: class="center" -->

---

<div style="text-align: left;">

## Objectifs p√©dagogiques

- Comprendre les vuln√©rabilit√©s dans les images Docker et leur impact
- Installer et utiliser Trivy pour scanner des images localement
- Interpr√©ter les rapports de vuln√©rabilit√©s (CVE, scores CVSS)
- Int√©grer Trivy dans des pipelines CI/CD (GitLab CI et GitHub Actions)
- Mettre en place des politiques de s√©curit√© pour bloquer les images vuln√©rables
- Appliquer des bonnes pratiques pour s√©curiser les images Docker

</div>

---

# Vuln√©rabilit√©s & D√©finitions
<!-- .slide: data-background="#009485" -->
<!-- .slide: class="center" -->

---

<div style="text-align: left;">

## Qu'est-ce qu'une vuln√©rabilit√© ? 

Une vuln√©rabilit√© est une faiblesse dans un logiciel qui peut √™tre exploit√©e par un attaquant pour :

- Ex√©cuter du code arbitraire
- Acc√©der √† des donn√©es sensibles
- Provoquer un d√©ni de service (DoS)
- √âlever ses privil√®ges
- Compromettre le syst√®me h√¥te

**Exemple concret** : La vuln√©rabilit√© Log4Shell (CVE-2021-44228) a permis l'ex√©cution de code √† distance dans des millions d'applications Java

</div>

---

<div style="text-align: left;">

## Probl√®mes courants

- Images obsol√®tes : Utilisation d'images non maintenues
- Packages inutiles : Surface d'attaque √©largie
- Secrets embarqu√©s : Cl√©s API, tokens dans l'image
- Privil√®ges excessifs : Conteneurs ex√©cut√©s en root
- Images non fiables : Provenance inconnue

</div>

---
<div style="text-align: left;">

## CVE et CVSS - Comprendre les scores de vuln√©rabilit√©s

**CVE (Common Vulnerabilities and Exposures)**

Identifiant unique pour chaque vuln√©rabilit√© connue  
Format : CVE-ANN√âE-NUM√âRO   

- Exemple : CVE-2023-12345

</div>
---
<div style="text-align: left;">

## CVE et CVSS - Comprendre les scores de vuln√©rabilit√©s

**CVSS (Common Vulnerability Scoring System)**

Syst√®me de notation de la gravit√© d'une vuln√©rabilit√© (0.0 √† 10.0)

| Score CVSS     | Gravit√©   | Couleur        | Action recommand√©e          |
|----------------|-----------|----------------|------------------------------|
| 0.0            | None      | üü¢ Vert        | Aucune action                |
| 0.1 - 3.9      | Low       | üü° Jaune       | Surveiller                   |
| 4.0 - 6.9      | Medium    | üü† Orange      | Corriger sous 30 jours       |
| 7.0 - 8.9      | High      | üî¥ Rouge       | Corriger sous 7 jours        |
| 9.0 - 10.0     | Critical  | üî¥ Critique    | Corriger imm√©diatement       |

**Facteurs d'√©valuation CVSS**

- Vecteur d'attaque : R√©seau, adjacent, local, physique
- Complexit√© : Facilit√© d'exploitation
- Privil√®ges requis : Aucun, faible, √©lev√©
- Impact : Confidentialit√©, int√©grit√©, disponibilit√©

</div>

---

# Trivy & Pr√©sentation 
<!-- .slide: data-background="#009485" -->
<!-- .slide: class="center" -->

---
<div style="text-align: left;">

## Pr√©sentation de Trivy

Trivy (prononc√© "tri-vee") est un scanner de vuln√©rabilit√©s open-source d√©velopp√© par Aqua Security

**Caract√©ristiques principales :**

- Complet : Scanne les images Docker, filesystems, Git repositories, Kubernetes
- Rapide : Base de donn√©es locale, r√©sultats en secondes
- Pr√©cis : Faible taux de faux positifs
- Facile √† utiliser : Une seule commande pour scanner
- Int√©grable : CI/CD, IDE, Kubernetes admission controllers
- Gratuit : 100% open-source

**Ce que Trivy d√©tecte :**

- Vuln√©rabilit√©s OS (Alpine, Ubuntu, Debian, RHEL, etc.)
- Vuln√©rabilit√©s dans les packages applicatifs (npm, pip, gem, etc.)
- Mauvaises configurations (Dockerfile, Kubernetes)
- Secrets expos√©s (cl√©s API, tokens)
- Licences logicielles

</div>

---

# Trivy & Utilisations 
<!-- .slide: data-background="#009485" -->
<!-- .slide: class="center" -->

---
<div style="text-align: left;">

## Premier scan - Les commandes de base

**Scanner une image Docker**

```bash
# Scan basique
trivy image nginx:latest

# Scan avec sortie d√©taill√©e
trivy image --severity HIGH,CRITICAL nginx:latest

# Scan avec format de sortie JSON
trivy image --format json --output results.json nginx:latest

# Scan avec format tabulaire (plus lisible)
trivy image --format table nginx:latest
```

</div>
---
<div style="text-align: left;">

## Premier scan - Les commandes de base

Scanner un Dockerfile

```bash
# Avant de builder l'image
trivy config Dockerfile

# Scanner pour les mauvaises configurations
trivy config --severity HIGH,CRITICAL Dockerfile
```

</div>
---
<div style="text-align: left;">

## Premier scan - Les commandes de base

Scanner un syst√®me de fichiers

```bash
# Scanner le r√©pertoire courant
trivy fs .

# Scanner un projet Node.js
trivy fs --scanners vuln,secret ./mon-projet-node

# Scanner uniquement les vuln√©rabilit√©s
trivy fs --scanners vuln ./
```

</div>
---
<div style="text-align: left;">

## Premier scan - Les commandes de base

**Scanner un repository Git**

```bash
# Scanner un d√©p√¥t distant
trivy repo https://github.com/username/repository

# Scanner un d√©p√¥t local
trivy repo .
```

</div>

---
<div style="text-align: left;">

## Options avanc√©es de Trivy

**Multiples examples**

```bash
# Ignorer les vuln√©rabilit√©s non corrig√©es
trivy image --ignore-unfixed nginx:latest

# Scanner uniquement certains types
trivy image --vuln-type os,library nginx:latest

# Filtrer par s√©v√©rit√©
trivy image --severity CRITICAL,HIGH nginx:latest

# D√©finir un code de sortie si vuln√©rabilit√©s trouv√©es
trivy image --exit-code 1 nginx:latest

# Nettoyer le cache
trivy image --clear-cache

# Mode offline (utiliser cache uniquement)
trivy image --offline-scan nginx:latest

# Scanner avec une base de donn√©es personnalis√©e
trivy image --skip-db-update --cache-dir ./my-cache nginx:latest
```

</div>

---
<div style="text-align: left;">

## Fichier .trivyignore - Ignorer des vuln√©rabilit√©s

Cr√©ez un fichier .trivyignore pour ignorer certaines CVE :

```bash
# .trivyignore
# Ignorer CVE sp√©cifiques (avec justification)

# CVE-2024-67890 - Fix not available yet, mitigation in place
CVE-2024-67890
```

</div>

---
<div style="text-align: left;">

## Exercice

- Cr√©er une app simple
- Introduire plusieurs vuln√©rabilit√©s intentionnel
- Scan cette image en local mais aussi via CI/CD
- √ätre capable de jouer avec certains params
    - return code
    - ignore-unfixed
    - trivy-ignore
    - ne pas scan les low/medium

</div>